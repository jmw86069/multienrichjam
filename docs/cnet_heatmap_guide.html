<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Optionally rotate igraph layout coordinates to help position labels • multienrichjam</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css"><script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet"><script src="pkgdown.js"></script><meta property="og:title" content="Optionally rotate igraph layout coordinates to help position labels"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-title-body">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">multienrichjam</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.87.900</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="articles/importIPA.html">How to import and use Ingenuity IPA enrichment data</a>
    </li>
  </ul></li>
<li>
  <a href="news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="http://github.com/jmw86069/multienrichjam/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
    <div class="page-header">
      <h1>Optionally rotate igraph layout coordinates to help position labels</h1>
    </div>


<div class="section level2">
<h2 id="brief-steps-to-produce-a-cnet-heatmap-plot">Brief steps to produce a Cnet-Heatmap plot<a class="anchor" aria-label="anchor" href="#brief-steps-to-produce-a-cnet-heatmap-plot"></a></h2>
<ol style="list-style-type: decimal"><li>
<p>Run multiEnrichMap()</p>
<ul><li>Apply appropriate p_cutoff, and topEnrichN to reduce the number of pathways per enrichment result, topEnrichN from 10 to 20 for two enrichment results; topEnrichN 4 to 10 for four or more enrichment results.</li>
</ul></li>
<li><p>Run mem_plot_folio()</p></li>
</ol><p><code>{r} cairo_pdf(file="folio_mem_DM_AffySoma_top20_23apr2020.pdf",    height=12, width=12, pointsize=11, onefile=TRUE); mem_dm_plots &lt;- mem_plot_folio(mem_dm_affysoma,    do_which=2:5,    pathway_column_split=4,    main="Dermatomyositis Affy-SomaLogic"); dev.off();</code></p>
<ul><li><p>Make sure <code>do_which</code> includes <code>c(2,4)</code>, which produces cnet_collapsed_set</p></li>
<li>
<p>Review the gene-protein heatmap to ensure the clusters are representative of the underlying content of the data. Adjust clustering parameters as needed, for example:</p>
<ul><li>
<code>column_method="correlation"</code> changes column clustering to use correlation, instead of euclidean distance, which can emphasize the top annotation enrichment colors, slightly more than the gene-protein matrix.</li>
<li>
<code>min_gene_ct=1</code>, <code>min_sample_ct=1</code> filters pathways and genes to require more than one gene per pathway, or more than one pathway per gene. Sometimes this filtering helps the clustering focus on genes/pathways which are shared rather than random singlet genes.</li>
<li>
<code>pathway_column_split=4</code> to adjust the number of pathway clusters, can be helpful if there are more or fewer clusters visible in the gene-pathway heatmap than are being produced by the automatic process. For large number of pathways, sometimes more clusters are necessary.</li>
<li>
<code>p_floor</code> especially when <code>p_cutoff</code> is lower than 0.01, the <code>p_floor</code> should be set appropriately to represent the range of enrichment P-values in the top annotation color bar. Note that it may not be useful to show P-values of 1e-100 – anything less than 1e-10 should in theory be equivalent.</li>
</ul></li>
<li><p>Note the location of Cnet clusters, <code>c("A", "B", "C", "D")</code> because they need to be defined manually in the Cnet-Heatmap.</p></li>
</ul><ol start="3" style="list-style-type: decimal"><li><strong>(Omit this step – now these steps are performed inside <code>plot_cnet_heatmaps()</code>)</strong></li>
</ol><p>Extract <code>cnet_collapsed_set</code> as the Cnet plot to use for the Cnet-Heatmap.</p>
<p>```{r} ht_opt(“legend_border”=“black”); cnet_collapsed_set &lt;- mem_dm_plots$cnet_collapsed_set;</p>
</div>
<div id="optionally-rotate-igraph-layout-coordinates-to-help-position-labels" class="section level1">

<p>#cnet_collapsed_set &lt;- rotate_igraph_layout(cnet_collapsed_set, degree=180); #cnet_collapsed_set &lt;- spread_igraph_labels(cnet_collapsed_set);</p>
<p>E(cnet_collapsed_set)<span class="math inline">$color &lt;- "#BBBBBB99";
V(cnet_collapsed_set)$</span>frame.color &lt;- “#77777799”; isset &lt;- V(cnet_collapsed_set)<span class="math inline"><em>n</em><em>o</em><em>d</em><em>e</em><em>T</em><em>y</em><em>p</em><em>e</em><em>V</em>(<em>c</em><em>n</em><em>e</em><em>t</em><sub><em>c</em></sub><em>o</em><em>l</em><em>l</em><em>a</em><em>p</em><em>s</em><em>e</em><em>d</em><sub><em>s</em></sub><em>e</em><em>t</em>)</span>label &lt;- ifelse(isset, V(cnet_collapsed_set)<span class="math inline"><em>n</em><em>a</em><em>m</em><em>e</em>, <em>V</em>(<em>c</em><em>n</em><em>e</em><em>t</em><sub><em>c</em></sub><em>o</em><em>l</em><em>l</em><em>a</em><em>p</em><em>s</em><em>e</em><em>d</em><sub><em>s</em></sub><em>e</em><em>t</em>)</span>label); V(cnet_collapsed_set)<span class="math inline">$label.family &lt;- "Arial";
V(cnet_collapsed_set)$</span>label.color &lt;- ifelse(isset, “grey85”, “grey10”); ## Manually add distance for label from node V(cnet_collapsed_set)<span class="math inline"><em>l</em><em>a</em><em>b</em><em>e</em><em>l</em>.<em>d</em><em>i</em><em>s</em><em>t</em> &lt;  − 0.8; <em>V</em>(<em>c</em><em>n</em><em>e</em><em>t</em><sub><em>c</em></sub><em>o</em><em>l</em><em>l</em><em>a</em><em>p</em><em>s</em><em>e</em><em>d</em><sub><em>s</em></sub><em>e</em><em>t</em>)</span>label.dist[igrep(“^PR”, V(cnet_collapsed_set)$name)] &lt;- 2;</p>
<pre><code>
   * Optionally adjust the network layout using some helpful functions:
   
      * `rotate_igraph_layout()` - rotate the layout so the clusters can
      be aligned with heatmaps on the outer edges.
      * `spread_igraph_labels()` - spreads out igraph labels based upon
      the angle of incoming edges, it does pretty well at reducing
      overlapping labels. Use `nodeSortBy` to change color-sorting from
      "left-to-right" with `nodeSortBy="x"`, to "top-to-bottom" with
      `nodeSortBy="-y"`. Use `label_min_dist` to increase the distance
      of labels from the node, where `0.5` is roughly half the node diameter,
      which is of course 1x radius. Use `force_relayout` and `repulse` to
      force a new layout with different repulse adjustment, higher repulse
      makes nodes more tightly grouped.

4. Prepare centered expression data, whose rownames are genes that are
present in the gene-pathway data above.

   * Typically data should be log2-transformed, and row-centered,
   which can be done using `jamma::centerGeneData()`.
   
      * Center each group by its associated control group, using
      `centerGroups` and `controlSamples` arguments. It is not
      recommended to scale the data, but that is available with
      `scale="row"`.
      * Optionally omit control groups from the heatmaps to maximize
      plot space. You may want to create a plot with control groups
      to verify that the control groups have low variability, then
      re-create the plot without control groups for the final figure.

   * Define `isamples` using `colnames()` of the expression matrix.
   * Define `igroups` to be a vector of group labels, named by
   `colnames()` of the expression matrix.
   * Define `colorV` whose names are unique values from `igroups`.

      * These `colorV` values are shown at the top of each heatmap
      as annotations to represent the groups in `igroups`. The
      names are displayed below the heatmap, should they should be
      small enough to fit in a limited space. Use `legend_labels`
      below to use a different label for the color legend.
      * Ideally these colors should also match the colors from
      `colorV` produced by `multiEnrichMap()`, but it is not required.
      * Note that when the color is matched between the sample group
      and the gene node, a box is drawn around the heatmap panel to
      indicate these genes were used in the enrichment test.

5. Run `plot_cnet_heatmap()`.

```{r}
{cairo_pdf(file="DM_Lupus_GeneProtein_MultiEnrich_Heatmap_27apr2020.pdf",
   height=9, width=10, pointsize=12);
all_samples_dmsle2
igroups_dlgp &lt;- gsubOrdered("[a-z_ ]+", "", all_cohort_type[all_samples_dmsle2])
colorV_dlgp &lt;- nameVector(mem_dmlupus_affysoma$colorV,
   levels(factor(igroups_dlgp[all_samples_dmsle2])));
pch_dlgp2 &lt;- plot_cnet_heatmaps(mem_folio=mem_dmlupus_affysoma_plots6,
   iexprs_ctr=all_pergene_exprs_ctr,
   isamples=all_samples_dmsle2,
   rotate_degrees=15,
   layout_reflect="y",
   igroups=igroups_dlgp,
   set_names=c("A","B","D","C"),
   set_panel_row=list(c(1:5), c(1:4), c(6:8), c(6:8)),
   cnet_mar=c(0.5, 6.2, 0.7, 6),
   vjust=c(0.9, 0.9, -0.5, -0.5),
   strwrap_width=c(60, 33, 36, 36),
   colorV=colorV_dlgp)
dev.off();}</code></pre>
<ul><li>There are numerous arguments to this function, intended to help configure the many details of the figure.</li>
<li>
<code>iexprs_ctr</code> - the expression data matrix, intended to show centered data, but in fact any numeric data is accepted.</li>
<li>
<code>allowed_degree=c(1,2)</code> uses any gene node with 1 or 2 connections for each cluster heatmap. When <code>allowed_degree=1</code> the heatmap will include genes that connect <em>only</em> to that pathway cluster, and no other pathway clusters. Sometimes it is useful to focus on specific genes, to make sure there are no changes visible in the heatmap across the other groups. If there are changes across other groups, the specificity may be an artifact of choosing too stringent a statistical threshold for gene hits prior to running the enrichment test.</li>
<li>
<code>legend_labels</code> are used to provide a custom label for the colors, helpful when <code>colorV</code> has abbreviated labels.</li>
<li>
<code>cnet_mar</code> - adjust margins <code>c(bottom, left, top, right)</code> around the central Cnet plot, to reduce overlaps across labels.</li>
<li>
<code>vjust</code> - vertical justification of pathway labels for each cluster, where <code>1</code> positions labels at the top of the top layout cell, <code>0</code> positions labels at the top of the next layout cell lower, and <code>-1</code> positions labels at the top of the layout cell two cells lower.</li>
<li>
<code>strwrap_width</code> is used to define the word wrap width for each pathway cluster. Sometimes it helps to make some sections wider or narrower than others, to reduce label overlaps.</li>
<li>
<code>set_names</code> vector of pathway clusters to use, in order. These names should reflect the cluster names such as <code>c("A", "B", "C", "D")</code>, but should be in order they appear in the Cnet layout.</li>
<li>Define <code>set_panel_row</code> and <code>set_panel_col</code> as the range of rows and columns for each heatmap. They should be positioned relatively close to the Cnet pathway clusters, with height relative to the number of genes.</li>
<li>
<code>use_shadowText=TRUE</code> uses a slight outline effect around node labels, which makes it easier to read over light/dark background colors.</li>
</ul><ol start="6" style="list-style-type: decimal"><li>Save the same data to Excel:</li>
</ol><p><code>{r} ## Convert to data.frame format dlgp_df_cnet &lt;- get_shared_pathways(ipa_pathways_all,    groups=mem_dmlupus_affysoma$enrichLabels,    cnet=mem_dmlupus_affysoma_plots6_v2$cnet_collapsed_set,    subset_cnet=TRUE); ## save to xlsx save_shared_pathways(file="DM_Lupus_GeneProtein_MultiEnrich_Heatmap_top4_20apr2020.xlsx",    df=dlgp_df_cnet,    sheetName="multienrich_DM_Lupus_GP",    colorSub=colorSub);</code></p>
</div>


  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>

</div>



      <footer><div class="copyright">
  <p></p><p>Developed by James M. Ward.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

